<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>패스파인더-공중·해상 표적 추적 프로그램</title>

  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />

  <!-- 스타일: UI 색상/레이아웃 정의 -->
<style>
    :root{
      --bg:#0b0f13; --panel:#0f172a; --muted:#94a3b8; --line:#1f2937;
      --text:#e5e7eb; --accent:#4ade80; --panel2:#0c1320;
    }
    html,body{height:100%}
    body{margin:0;display:grid;grid-template-columns:380px 1fr;height:100vh;
         background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif}

    aside {
  position: relative; 
  border-right: 1px solid var(--line);
  overflow: visible;
  background: rgba(255,255,255,0.02);
}
    main{position:relative}
    #map{position:absolute;inset:0}
    h2{margin:0 0 8px 0;font-size:15px}
    .pane{padding:14px 16px;border-bottom:1px solid var(--line);background:var(--panel)}
    .pane:nth-child(even){background:var(--panel2)}
    .row{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
    .field{flex:1;display:flex;flex-direction:column;gap:6px;min-width:130px}
    .label{font-size:12px;color:var(--muted)}
    input,select,button{padding:10px;border:1px solid var(--line);border-radius:10px;background:#0b1220;color:var(--text)}
    input[type="number"]{text-align:right}
    button{cursor:pointer}
    .list{max-height:150px;overflow:auto;border:1px dashed var(--line);padding:8px;border-radius:10px;background:rgba(0,0,0,0.15)}
    .pill{display:inline-flex;gap:6px;align-items:center;padding:4px 8px;border-radius:999px;border:1px solid var(--line);margin:2px 6px 2px 0;background:#0b1220}
    .pill .x{cursor:pointer;opacity:.8}
    .help{font-size:12px;color:var(--muted)}
    [data-coord-mode="MGRS"] .ll-only{display:none}
    [data-coord-mode="LL"] .mgrs-only{display:none}
    .hr{height:1px;background:var(--line);margin:10px 0}

    .custom-label { pointer-events:auto; user-select:none; }
    .label-box {
      font-size:13px; padding:4px 8px; border:1px solid #aaa; border-radius:4px;
      white-space:nowrap; display:inline-block; transform:translate(-50%,-50%);
      opacity:.85; transition:all .2s ease;
    }
    .label-box.hover { opacity:1; box-shadow:0 0 4px rgba(0,0,0,.4); }

    /* 사이드바 접이식 */
    .pane { padding:0; }
    .pane h2{
      font-size:17px; font-weight:700; margin:0; padding:12px 16px; cursor:pointer;
      display:flex; align-items:center; gap:8px;
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,0));
      border-bottom:1px solid var(--line); user-select:none;
    }
    .pane .pane-content{ padding:12px 16px; }
    .pane.collapsed > .pane-content{ display:none; }
    .pane h2 .chev{ margin-left:auto; transition:transform .2s ease; opacity:.8; }
    .pane.collapsed h2 .chev{ transform:rotate(-90deg); }

    /* 관측점 편집 패널 스타일 */
    #obsEditPanel { border:1px solid var(--line); border-radius:12px; padding:10px; background:#0b1220; }
    #obsEditPanel .row + .row { margin-top: 8px; }

    /* 지도타입/내위치 커스텀 컨트롤 */
    .leaflet-control.custom-box {
      background:#0b1220; color:var(--text); border:1px solid var(--line);
      border-radius:10px; padding:8px; box-shadow:0 4px 12px rgba(0,0,0,.25);
      display:flex; gap:6px; align-items:center;
    }
    .custom-box .btn {
      font-size:12px; padding:6px 10px; border-radius:8px; border:1px solid var(--line);
      background:#0b1220; color:var(--text);
    }
    .custom-box .btn.active { border-color: var(--accent); box-shadow:0 0 0 1px var(--accent) inset; }
    .leaflet-control.custom-box{ display:block; }



.custom-box .fold-header{
  display:flex; align-items:center; gap:8px; padding:8px 10px; cursor:pointer;
  border-bottom:1px solid var(--line); user-select:none;
}
.custom-box .fold-header .title{ font-size:13px; font-weight:600; }
.custom-box .fold-header .chev{ margin-left:auto; transition:transform .2s ease; opacity:.8; }
.custom-box.collapsed .fold-header .chev{ transform:rotate(-90deg); }

.leaflet-control.custom-box .fold-content{
  overflow: hidden;
  max-height: 0; 
  opacity: 0;
  padding: 0 10px; 
  transition:
    max-height 260ms ease,
    opacity    220ms ease,
    padding    200ms ease;
}

.leaflet-control.custom-box:not(.collapsed) .fold-content{
  max-height: 800px;
  opacity: 1;
  padding: 8px 10px;
}

@media (prefers-reduced-motion: reduce){
  .leaflet-control.custom-box .fold-content{
    transition: none;
  }
}


.custom-box .btn-row{ display:flex; gap:6px; margin-bottom:6px; flex-wrap:wrap; }
.custom-box .btn{
  font-size:12px; padding:6px 10px; border-radius:8px; border:1px solid var(--line);
  background:#0b1220; color:var(--text); cursor:pointer;
}
.custom-box .btn.active { border-color: var(--accent); box-shadow:0 0 0 1px var(--accent) inset; }

/* 전체 사이드바 접기 */
body.sidebar-collapsed{
  grid-template-columns: 0 1fr;
}
body.sidebar-collapsed aside{
  border-right: none; overflow: hidden;
}

#asideToggle, #asideExpand {
  position: absolute; right: -14px; top: 50%;
  transform: translateY(-50%);
  width: 28px; height: 64px; border-radius: 12px;
  border: 1px solid var(--line); background: #0b1220; color: var(--text);
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 4px 12px rgba(0,0,0,.25); cursor: pointer; z-index: 2001;
}

#asideExpand{
  left: -14px; right: auto;
}

#asideToggle{ display: flex; }
#asideExpand{ display: none; }
body.sidebar-collapsed #asideToggle{ display: none; }
body.sidebar-collapsed #asideExpand{ display: flex; }

#asideToggle::after{ content: "‹"; font-size: 18px; font-weight: 700; }
#asideExpand::after{ content: "›"; font-size: 18px; font-weight: 700; }
/* 전체 사이드바 접기 */

/* 사이드바 제목 왼쪽에 +/− 아이콘 표시 */
.pane h2{ position:relative; padding-left:28px; }
.pane h2::before{
  content:"−"; position:absolute; left:10px; top:50%;
  transform:translateY(-50%); width:14px; text-align:center;
  font-weight:900; opacity:.9;
}
.pane.collapsed h2::before{ content:"+"; }

aside{
  height: 100vh;
}

.aside-scroll{
  height: 100%;
  overflow: auto;
}
.aside-scroll::-webkit-scrollbar{
  width: 0; height: 0;          /* Chrome/Safari */
}

body{ grid-template-columns: 1fr !important; }

aside{
  position: fixed;                                       
  left: 0; top: 0; height: 100vh; width: 380px;    
  transform: translateX(0);                            
  transition: transform 260ms ease;
  z-index: 2000;
}

/* 접힘 상태: 사이드바만 화면 밖으로 슬라이드 */
body.sidebar-collapsed aside{
  transform: translateX(-100%);
  /* border-right/overflow는 기존 값 유지해도 무방 */
}

/* 우측 중앙 핸들 위치는 fixed 사이드바 기준으로 동일하게 동작 */
#asideToggle{ right: -14px; }      /* 필요시 -16, -18 등 미세 조정 */

/* 그리기도구(좌측 상단 컨테이너)가 사이드바를 따라다니도록 */
.leaflet-control-container .leaflet-top.leaflet-left{
  left: 12px
  transition: left 260ms ease;
}

/* 사이드바가 열려 있을 때: 사이드바 너비(380) + 간격(12) 만큼 우측으로 이동 */
body:not(.sidebar-collapsed) .leaflet-control-container .leaflet-top.leaflet-left{
  left: 392px;                /* 380 + 12 */
}

/* ===== 모바일 최적화 (<= 768px) ===== */
@media (max-width: 768px){

  /* 사이드바: 전체 화면 오버레이로 넓게 */
  aside{
    width: calc(100vw - 16px);
    height: 100dvh; /* iOS 안전영역 대응 */
    padding-bottom: max(env(safe-area-inset-bottom, 0px), 8px);
  }

  /* 사이드바 제목 터치 영역 확대 */
  .pane h2{
    font-size: 16px;
    padding: 14px 16px 14px 32px; /* +/− 아이콘 공간 */
  }

  /* 사이드바 접기/펼치기 버튼(핸들) 터치 크기 업 */
  #asideToggle, #asideExpand{
    width: 36px; height: 72px; border-radius: 14px;
  }
  #asideToggle::after, #asideExpand::after{ font-size: 20px; }

  /* 내부 스크롤: 스크롤은 되되 바는 숨김(모바일 미려) */
  .aside-scroll{
    height: 100%;
    overflow: auto;
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .aside-scroll::-webkit-scrollbar{ width:0; height:0; }

  /* 지도 컨트롤(좌상단) 사이드바 따라 이동 — 기존 392px → 모바일 폭 기준 계산 */
  .leaflet-control-container .leaflet-top.leaflet-left{
    left: 12px; transition: left 260ms ease;
  }
  body:not(.sidebar-collapsed) .leaflet-control-container .leaflet-top.leaflet-left{
    left: calc(100vw - 16px + 12px); /* aside width + 여백 */
  }

  /* 우측 상단(지도 모드 박스)이 너무 겹치면 약간 안쪽으로 */
  .leaflet-control.custom-box{ margin-top: 8px; margin-right: 8px; }

  /* 버튼류 터치 간격 확보 */
  .custom-box .btn, button, input, select{
    padding: 12px 12px;
    font-size: 14px;
  }

  /* 지도 모드 패널 내부 버튼을 2열 그리드로 (세로 길이 단축) */
  .custom-box .btn-row{ display:grid; grid-template-columns: 1fr 1fr; gap:8px; }
  .custom-box .btn-row:has(#btnLocate){ grid-template-columns: 1fr; } /* 내 위치는 한 줄 */

  /* 스트리트뷰 제거했더라도 기타 패널이 너무 길면 접힘 기본 */
  .pane{ border-bottom: 1px solid var(--line); }
  .pane:not(.collapsed) .pane-content{ padding-bottom: 12px; }
}

/* 초소형 기기(<= 390px)에서 여백 조금 더 작게 */
@media (max-width: 390px){
  body{ font-size: 14px; }
  .pane h2{ font-size: 15px; }
}

#splash-overlay{
  position: fixed; inset: 0; z-index: 99999;
  background: #0b1220; display: grid; place-items: center;
  opacity: 1; pointer-events: none;
  transition: opacity 0.5s ease;
}
#splash-overlay .splash-text {
  text-align: center;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, sans-serif;
}
#splash-overlay .title {
  font-size: clamp(32px, 7vw, 72px);
  font-weight: 800;
  letter-spacing: 0.06em;
  color: #fff;
}
#splash-overlay .subtitle {
  margin-top: 12px;
  font-size: clamp(16px, 3vw, 24px);
  font-weight: 400;
  color: #999;
}
#splash-overlay.fade-out{ opacity: 0; }

a {
  color: #fff;
  text-decoration: underline;
}

a:hover {
  color: #ccc;
}

.btn-link {
  display:inline-block;
  padding:8px 16px;
  background:#555;
  color:#fff;          
  border-radius:6px;
  text-decoration:none;
}
.btn-link:hover {
  background:#aaa;   
}
  </style>

  
  <!-- 라이브러리/앱 스크립트 로드 -->
<script defer src="https://cdn.jsdelivr.net/npm/mgrs@2.1.0/dist/mgrs.min.js"></script><script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script defer src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
  <script defer src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>

  
  <script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyClzD_uoZnDTmMhjE_Xu-2JhJW9KoZhfKk"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/leaflet.gridlayer.googlemutant@0.14.0/dist/Leaflet.GoogleMutant.min.js"></script>

  <script defer src="app.js"></script>

<div id="splash-overlay" aria-hidden="true">
  <div class="splash-text">
    <div class="title">패스 파인더</div>
    <div class="subtitle">공중·해상 표적 추적 프로그램</div>
  </div>
기획 / 개발 : 육군 상사 김정열<br>
</div>

</head>

<script>
(function(){
  const overlay = document.getElementById('splash-overlay');
  if(!overlay) return;
  window.addEventListener('load', () => {
    setTimeout(() => {
      overlay.classList.add('fade-out');
    }, 2000);
    overlay.addEventListener('transitionend', () => {
      overlay.remove();
      try { window.dispatchEvent(new Event('resize')); } catch(e){}
    }, { once: true });
  });
})();

</script>

<body data-coord-mode="MGRS">
  <!-- 사이드바: 도구/설정 패널 -->
<aside>
    <div class="pane">
<h2> Path Finder</h2>
<a href="history.html" class="btn-link">주요기능 설명(클릭)</a>
	</div>
    <div class="pane">
      <h2>좌표 모드</h2>
      <div class="pane-content">
        <div class="row">
          <div class="field">
            <span class="label">좌표 모드</span>
            <select id="coordMode">
              <option value="MGRS" selected>MGRS</option>
              <option value="LL">위도/경도</option>
            </select>
          </div>
          <div class="field">
            <span class="label">라벨 표시</span>
            <label style="display:flex;gap:8px;align-items:center"><input id="toggleLabels" type="checkbox" checked /> 켜기/끄기</label>
          </div>
        </div>
        <div class="row mgrs-only">
          <div class="field">
            <span class="label">관측점 MGRS</span>
            <input id="obsMGRS" placeholder="52S DM 12345 67890" />
          </div>
        </div>
        <div class="row ll-only">
          <div class="field">
            <span class="label">관측점 위도</span>
            <input id="obsLat" type="number" step="0.000001" />
          </div>
          <div class="field">
            <span class="label">관측점 경도</span>
            <input id="obsLon" type="number" step="0.000001" />
          </div>
        </div>
        <div class="help">지도 클릭 시 좌표가 갱신됩니다.</div>
      </div>
    </div>

    <div class="pane">
      <h2>바람 경로 예측</h2>
      <div class="pane-content">
        <div class="row mgrs-only">
          <div class="field">
            <span class="label">시작점 MGRS</span>
            <input id="driftMGRS" placeholder="52S DM 12345 67890" />
          </div>
        </div>
        <div class="row ll-only">
          <div class="field">
            <span class="label">시작 위도</span>
            <input id="driftLat" type="number" step="0.000001" />
          </div>
          <div class="field">
            <span class="label">시작 경도</span>
            <input id="driftLon" type="number" step="0.000001" />
          </div>
        </div>
        <div class="row">
          <div class="field"><span class="label">예측 시간(분)</span><input id="driftMinutes" type="number" value="60"></div>
          <div class="field"><span class="label">표시 간격(분)</span><input id="markerIntervalMin" type="number" value="1"></div>
          <div class="field"><span class="label">스텝(초)</span><input id="stepSeconds" type="number" value="60"></div>
        </div>
        <div class="row">
          <div class="field"><span class="label">재조회 주기(초)</span><input id="refreshSec" type="number" value="0"></div>
          <div class="field"><span class="label">가속 계수</span><input id="accelFactor" type="number" value="1"></div>
          <div class="field"><span class="label">고도</span>
            <select id="windSource">
              <option value="10m">10 m</option>
              <option value="925" selected>925 hPa (~3000 ft)</option>
              <option value="850">850 hPa</option>
              <option value="800">800 hPa</option>
            </select>
          </div>
        </div>
        <div class="row">
          <button id="pickStartBtn">지도에서 시작점 선택</button>
          <button id="runWindSim">예상 경로 계산</button>
          <button id="clearDrift">경로 삭제</button>
        </div>
        <div id="windMeta" class="help" style="margin-top:6px">—</div>
      </div>
    </div>

    <div class="pane">
      <h2>교차점 계산</h2>
      <div class="pane-content">
        <div class="row">
          <div class="field"><span class="label">이름</span><input id="obsName" placeholder="관측1" /></div>
          <div class="field"><span class="label">방위(°)</span><input id="obsBearing" type="number" value="0" /></div>
          <div class="field"><span class="label">길이(km)</span><input id="lineKm" type="number" value="20" /></div>
        </div>
        <div class="row">
          <button id="addObserverBtn">관측점 추가</button>
          <button id="recomputeX">교차 재계산</button>
          <button id="clearObs">모든 관측점 삭제</button>
        </div>
        <div class="list" id="observerList"></div>

        <div class="hr"></div>

        
        <div id="obsEditPanel" hidden>
          <div class="help" style="margin-bottom:6px">선택한 관측점을 편집합니다.</div>
          <div class="row">
            <div class="field"><span class="label">이름</span><input id="editName" /></div>
            <div class="field"><span class="label">방위(°)</span><input id="editBearing" type="number" /></div>
            <div class="field"><span class="label">길이(km)</span><input id="editLineKm" type="number" /></div>
          </div>
          <div class="row mgrs-only">
            <div class="field"><span class="label">MGRS</span><input id="editMGRS" placeholder="52S DM 12345 67890" /></div>
          </div>
          <div class="row ll-only">
            <div class="field"><span class="label">위도</span><input id="editLat" type="number" step="0.000001" /></div>
            <div class="field"><span class="label">경도</span><input id="editLon" type="number" step="0.000001" /></div>
          </div>
          <div class="row">
            <button id="editPick">지도에서 좌표 선택</button>
            <span style="flex:1"></span>
            <button id="editSave">저장</button>
            <button id="editCancel">닫기</button>
          </div>
        </div>
      </div>
    </div>

    <div class="pane collapsed" aria-expanded="false">
      <h2>계산된 교차점</h2>
      <div class="pane-content">
        <div class="list" id="crossList"></div>
        <div class="row">
          <button id="clearXRemoved">숨긴 교차점 표시</button>
        </div>
      </div>
    </div>

    <div class="pane collapsed" aria-expanded="false">
      <h2>도형 삭제</h2>
      <div class="pane-content">
        <div class="row">
          <button id="clearShapes">모든 도형 삭제</button>
        </div>
      </div>
    </div>

    <div class="pane collapsed" aria-expanded="false">
      <h2>데이터 스냅샷 / 가져오기·내보내기</h2>
      <div class="pane-content">
        <div class="row">
          <button id="saveSnapshot">스냅샷 저장</button>
          <button id="loadSnapshot">스냅샷 불러오기</button>
          <button id="exportSnapshot">JSON 내보내기</button>
          <label class="pill"><input type="file" id="importFile" style="display:none"><span>JSON 가져오기</span></label>
        </div>
      </div>
    </div>

    
    <div id="editPanel" hidden>
      <button id="closeEditBtn" type="button"></button>
      <button id="saveEditBtn" type="button"></button>
    </div>

  <button id="asideToggle" type="button" title="사이드바 숨기기"></button>
  </aside>

  <main>
  <button id="asideExpand" type="button" title="사이드바 보이기"></button>
    <!-- 지도 컨테이너: Leaflet 지도가 렌더링되는 영역 -->
<div id="map"></div>
</main>

</body>

<script>
/* 탭 타이틀 마키(흐름) 효과 — 길어진 제목을 순환 스크롤 */
(function(){
  const base = "Path Finder - 공중·해상 표적 추적 프로그램";
  const gap  = "   •   ";
  const speedMs = 180;
  const headPause = 1000;

  let loopId = null;
  let idx = 0;
  const roll = base + gap;
  const full = roll + base;

  function step(){
    document.title = full.slice(idx, idx + 60);
    idx = (idx + 1) % roll.length;
  }

  function start(){
    stop();
    document.title = base;
    setTimeout(()=> {
      step();
      loopId = setInterval(step, speedMs);
    }, headPause);
  }

  function stop(){
    if (loopId) { clearInterval(loopId); loopId = null; }
  }

  window.addEventListener("load", start);
  window.__titleMarquee = { start, stop };
})();
</script>

</html>
