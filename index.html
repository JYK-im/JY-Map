<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì§€ë„ ë„êµ¬</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />

  <style>
    :root{
      --bg:#0b0f13; --panel:#0f172a; --muted:#94a3b8; --line:#1f2937;
      --text:#e5e7eb; --accent:#4ade80; --panel2:#0c1320;
    }
    html,body{height:100%}
    body{margin:0;display:grid;grid-template-columns:380px 1fr;height:100vh;
         background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif}
    aside{border-right:1px solid var(--line);overflow:auto;background:rgba(255,255,255,0.02)}
    main{position:relative}
    #map{position:absolute;inset:0}
    h2{margin:0 0 8px 0;font-size:15px}
    .pane{padding:14px 16px;border-bottom:1px solid var(--line);background:var(--panel)}
    .pane:nth-child(even){background:var(--panel2)}
    .row{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
    .field{flex:1;display:flex;flex-direction:column;gap:6px;min-width:130px}
    .label{font-size:12px;color:var(--muted)}
    input,select,button{padding:10px;border:1px solid var(--line);border-radius:10px;background:#0b1220;color:var(--text)}
    input[type="number"]{text-align:right}
    button{cursor:pointer}
    .list{max-height:150px;overflow:auto;border:1px dashed var(--line);padding:8px;border-radius:10px;background:rgba(0,0,0,0.15)}
    .pill{display:inline-flex;gap:6px;align-items:center;padding:4px 8px;border-radius:999px;border:1px solid var(--line);margin:2px 6px 2px 0;background:#0b1220}
    .pill .x{cursor:pointer;opacity:.8}
    .help{font-size:12px;color:var(--muted)}
    [data-coord-mode="MGRS"] .ll-only{display:none}
    [data-coord-mode="LL"] .mgrs-only{display:none}
    .hr{height:1px;background:var(--line);margin:10px 0}

    .custom-label { pointer-events:auto; user-select:none; }
    .label-box {
      font-size:13px; padding:4px 8px; border:1px solid #aaa; border-radius:4px;
      white-space:nowrap; display:inline-block; transform:translate(-50%,-50%);
      opacity:.85; transition:all .2s ease;
    }
    .label-box.hover { opacity:1; box-shadow:0 0 4px rgba(0,0,0,.4); }

    /* ì‚¬ì´ë“œë°” ì ‘ì´ì‹ */
    .pane { padding:0; }
    .pane h2{
      font-size:17px; font-weight:700; margin:0; padding:12px 16px; cursor:pointer;
      display:flex; align-items:center; gap:8px;
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,0));
      border-bottom:1px solid var(--line); user-select:none;
    }
    .pane .pane-content{ padding:12px 16px; }
    .pane.collapsed > .pane-content{ display:none; }
    .pane h2 .chev{ margin-left:auto; transition:transform .2s ease; opacity:.8; }
    .pane.collapsed h2 .chev{ transform:rotate(-90deg); }

    /* ê´€ì¸¡ì  í¸ì§‘ íŒ¨ë„ ìŠ¤íƒ€ì¼ */
    #obsEditPanel { border:1px solid var(--line); border-radius:12px; padding:10px; background:#0b1220; }
    #obsEditPanel .row + .row { margin-top: 8px; }

    /* ì§€ë„íƒ€ì…/ë‚´ìœ„ì¹˜ ì»¤ìŠ¤í…€ ì»¨íŠ¸ë¡¤ */
    .leaflet-control.custom-box {
      background:#0b1220; color:var(--text); border:1px solid var(--line);
      border-radius:10px; padding:8px; box-shadow:0 4px 12px rgba(0,0,0,.25);
      display:flex; gap:6px; align-items:center;
    }
    .custom-box .btn {
      font-size:12px; padding:6px 10px; border-radius:8px; border:1px solid var(--line);
      background:#0b1220; color:var(--text);
    }
    .custom-box .btn.active { border-color: var(--accent); box-shadow:0 0 0 1px var(--accent) inset; }
    .leaflet-control.custom-box{ display:block; }



.custom-box .fold-header{
  display:flex; align-items:center; gap:8px; padding:8px 10px; cursor:pointer;
  border-bottom:1px solid var(--line); user-select:none;
}
.custom-box .fold-header .title{ font-size:13px; font-weight:600; }
.custom-box .fold-header .chev{ margin-left:auto; transition:transform .2s ease; opacity:.8; }
.custom-box.collapsed .fold-header .chev{ transform:rotate(-90deg); }

.leaflet-control.custom-box .fold-content{
  overflow: hidden;
  max-height: 0;          /* ì ‘í˜ ìƒíƒœ ê¸°ë³¸ê°’ */
  opacity: 0;
  padding: 0 10px;        /* ì ‘íŒ ìƒíƒœ íŒ¨ë”©ì„ 0ìœ¼ë¡œ (ì¢Œìš°ë§Œ ë‚¨ê¹€) */
  transition:
    max-height 260ms ease,
    opacity    220ms ease,
    padding    200ms ease;
}

.leaflet-control.custom-box:not(.collapsed) .fold-content{
  max-height: 800px;      /* ì½˜í…ì¸  ìµœëŒ€ ë†’ì´ë³´ë‹¤ ì¡°ê¸ˆ í¬ê²Œ */
  opacity: 1;
  padding: 8px 10px;      /* ì›ë˜ íŒ¨ë”© ë³µì› */
}

@media (prefers-reduced-motion: reduce){
  .leaflet-control.custom-box .fold-content{
    transition: none;
  }
}


.custom-box .btn-row{ display:flex; gap:6px; margin-bottom:6px; flex-wrap:wrap; }
.custom-box .btn{
  font-size:12px; padding:6px 10px; border-radius:8px; border:1px solid var(--line);
  background:#0b1220; color:var(--text); cursor:pointer;
}
.custom-box .btn.active { border-color: var(--accent); box-shadow:0 0 0 1px var(--accent) inset; }

/* ì „ì²´ ì‚¬ì´ë“œë°” ì ‘ê¸° */
body.sidebar-collapsed{
  grid-template-columns: 0 1fr;
}
body.sidebar-collapsed aside{
  border-right: none; overflow: hidden;
}

#asideToggle, #asideExpand {
  position: absolute; right: -14px; top: 50%;
  transform: translateY(-50%);
  width: 28px; height: 64px; border-radius: 12px;
  border: 1px solid var(--line); background: #0b1220; color: var(--text);
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 4px 12px rgba(0,0,0,.25); cursor: pointer; z-index: 2001;
}

#asideExpand{
  left: -14px; right: auto;
}

#asideToggle{ display: flex; }
#asideExpand{ display: none; }
body.sidebar-collapsed #asideToggle{ display: none; }
body.sidebar-collapsed #asideExpand{ display: flex; }

#asideToggle::after{ content: "â€¹"; font-size: 18px; font-weight: 700; }
#asideExpand::after{ content: "â€º"; font-size: 18px; font-weight: 700; }
/* ì „ì²´ ì‚¬ì´ë“œë°” ì ‘ê¸° */

  /* === smooth fold animation for custom-box === */
.leaflet-control.custom-box .fold-content{
  overflow: hidden;
  max-height: 0;
  opacity: 0;
  padding: 0 10px;
  transition:
    max-height 260ms ease,
    opacity    220ms ease,
    padding    200ms ease;
}
.leaflet-control.custom-box:not(.collapsed) .fold-content{
  max-height: 800px;
  opacity: 1;
  padding: 8px 10px;
}
@media (prefers-reduced-motion: reduce){
  .leaflet-control.custom-box .fold-content{ transition: none; }
}


/* === sidebar pane header +/- indicators === */
.pane h2{ position: relative; padding-left: 28px; }
.pane h2::before{
  content: "âˆ’";
  position: absolute; left: 10px; top: 50%;
  transform: translateY(-50%);
  width: 14px; text-align: center;
  font-weight: 900; opacity: .9;
}
.pane.collapsed h2::before{ content: "+"; }


/* === sidebar collapse toggle buttons === */
body.sidebar-collapsed{ grid-template-columns: 0 1fr; }
body.sidebar-collapsed aside{ border-right: none; overflow: hidden; }
aside{ position: relative; }

#asideToggle, #asideExpand {
  position: absolute; right: -14px; top: 50%;
  transform: translateY(-50%);
  width: 28px; height: 64px; border-radius: 12px;
  border: 1px solid var(--line); background: #0b1220; color: var(--text);
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 4px 12px rgba(0,0,0,.25); cursor: pointer; z-index: 2001;
}
#asideExpand{ left: -14px; right: auto; }
#asideToggle{ display: flex; }
#asideExpand{ display: none; }
body.sidebar-collapsed #asideToggle{ display: none; }
body.sidebar-collapsed #asideExpand{ display: flex; }
#asideToggle::after{ content: "â€¹"; font-size: 18px; font-weight: 700; }
#asideExpand::after{ content: "â€º"; font-size: 18px; font-weight: 700; }


/* === custom-box layout fix === */
.leaflet-control.custom-box{ display: block; }
</style>

  <!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script defer src="https://cdn.jsdelivr.net/npm/mgrs@2.1.0/dist/mgrs.min.js"></script>
  <script defer src="https://unpkg.com/proj4@2.9.2/dist/proj4.js"></script>
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script defer src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
  <script defer src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>

  <!-- Google Maps JS API & GoogleMutant -->
  <!-- NOTE: í‚¤ëŠ” ë³¸ì¸ í‚¤ë¡œ êµì²´ -->
  <script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyClzD_uoZnDTmMhjE_Xu-2JhJW9KoZhfKk"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/leaflet.gridlayer.googlemutant@0.14.0/dist/Leaflet.GoogleMutant.min.js"></script>

  <script defer src="app.js"></script>
</head>

<body data-coord-mode="MGRS">
  <aside>
    <div class="pane">
      <h2>ğŸ“ ì¢Œí‘œ ì…ë ¥ ë° ë³€í™˜</h2>
      <div class="pane-content">
        <div class="row">
          <div class="field">
            <span class="label">ì¢Œí‘œ ëª¨ë“œ</span>
            <select id="coordMode">
              <option value="MGRS" selected>MGRS</option>
              <option value="LL">ìœ„ë„/ê²½ë„</option>
            </select>
          </div>
          <div class="field">
            <span class="label">ë¼ë²¨ í‘œì‹œ</span>
            <label style="display:flex;gap:8px;align-items:center"><input id="toggleLabels" type="checkbox" checked /> ì¼œê¸°/ë„ê¸°</label>
          </div>
        </div>
        <div class="row mgrs-only">
          <div class="field">
            <span class="label">ê´€ì¸¡ì  MGRS</span>
            <input id="obsMGRS" placeholder="52S DM 12345 67890" />
          </div>
        </div>
        <div class="row ll-only">
          <div class="field">
            <span class="label">ê´€ì¸¡ì  ìœ„ë„</span>
            <input id="obsLat" type="number" step="0.000001" />
          </div>
          <div class="field">
            <span class="label">ê´€ì¸¡ì  ê²½ë„</span>
            <input id="obsLon" type="number" step="0.000001" />
          </div>
        </div>
        <div class="help">ì§€ë„ í´ë¦­ ì‹œ MGRS/ìœ„ê²½ë„ í•„ë“œê°€ í•¨ê»˜ ê°±ì‹ ë©ë‹ˆë‹¤.</div>
      </div>
    </div>

    <div class="pane">
      <h2>ğŸŒ¬ ë°”ëŒ ê²½ë¡œ ì˜ˆì¸¡</h2>
      <div class="pane-content">
        <div class="row mgrs-only">
          <div class="field">
            <span class="label">ì‹œì‘ì  MGRS</span>
            <input id="driftMGRS" placeholder="52S DM 12345 67890" />
          </div>
        </div>
        <div class="row ll-only">
          <div class="field">
            <span class="label">ì‹œì‘ ìœ„ë„</span>
            <input id="driftLat" type="number" step="0.000001" />
          </div>
          <div class="field">
            <span class="label">ì‹œì‘ ê²½ë„</span>
            <input id="driftLon" type="number" step="0.000001" />
          </div>
        </div>
        <div class="row">
          <div class="field"><span class="label">ì˜ˆì¸¡ ì‹œê°„(ë¶„)</span><input id="driftMinutes" type="number" value="60"></div>
          <div class="field"><span class="label">í‘œì‹œ ê°„ê²©(ë¶„)</span><input id="markerIntervalMin" type="number" value="10"></div>
          <div class="field"><span class="label">ìŠ¤í…(ì´ˆ)</span><input id="stepSeconds" type="number" value="60"></div>
        </div>
        <div class="row">
          <div class="field"><span class="label">ì¬ì¡°íšŒ ì£¼ê¸°(ì´ˆ)</span><input id="refreshSec" type="number" value="0"></div>
          <div class="field"><span class="label">ê°€ì† ê³„ìˆ˜</span><input id="accelFactor" type="number" value="1"></div>
          <div class="field"><span class="label">ë°”ëŒ ë ˆë²¨</span>
            <select id="windSource">
              <option value="10m">10 m</option>
              <option value="925" selected>925 hPa (~3000 ft)</option>
              <option value="850">850 hPa</option>
              <option value="800">800 hPa</option>
            </select>
          </div>
        </div>
        <div class="row">
          <button id="pickStartBtn">ì§€ë„ì—ì„œ ì‹œì‘ì  ì„ íƒ</button>
          <button id="runWindSim">ë°”ëŒ ë¶ˆëŸ¬ì™€ ê²½ë¡œ ê³„ì‚°</button>
          <button id="clearDrift">ë°”ëŒ ê²½ë¡œ ì‚­ì œ</button>
        </div>
        <div id="windMeta" class="help" style="margin-top:6px">â€”</div>
      </div>
    </div>

    <div class="pane">
      <h2>ğŸ”­ ê´€ì¸¡ì  ë° êµì°¨ì„ </h2>
      <div class="pane-content">
        <div class="row">
          <div class="field"><span class="label">ì´ë¦„</span><input id="obsName" placeholder="ê´€ì¸¡1" /></div>
          <div class="field"><span class="label">ë°©ìœ„(Â°)</span><input id="obsBearing" type="number" value="0" /></div>
          <div class="field"><span class="label">ê¸¸ì´(km)</span><input id="lineKm" type="number" value="20" /></div>
        </div>
        <div class="row">
          <button id="addObserverBtn">ê´€ì¸¡ì  ì¶”ê°€</button>
          <button id="recomputeX">êµì°¨ ì¬ê³„ì‚°</button>
          <button id="clearObs">ëª¨ë“  ê´€ì¸¡ì  ì‚­ì œ</button>
        </div>
        <div class="list" id="observerList"></div>

        <div class="hr"></div>

        <!-- ê´€ì¸¡ì  í¸ì§‘ íŒ¨ë„ -->
        <div id="obsEditPanel" hidden>
          <div class="help" style="margin-bottom:6px">ì„ íƒí•œ ê´€ì¸¡ì ì„ í¸ì§‘í•©ë‹ˆë‹¤.</div>
          <div class="row">
            <div class="field"><span class="label">ì´ë¦„</span><input id="editName" /></div>
            <div class="field"><span class="label">ë°©ìœ„(Â°)</span><input id="editBearing" type="number" /></div>
            <div class="field"><span class="label">ê¸¸ì´(km)</span><input id="editLineKm" type="number" /></div>
          </div>
          <div class="row mgrs-only">
            <div class="field"><span class="label">MGRS</span><input id="editMGRS" placeholder="52S DM 12345 67890" /></div>
          </div>
          <div class="row ll-only">
            <div class="field"><span class="label">ìœ„ë„</span><input id="editLat" type="number" step="0.000001" /></div>
            <div class="field"><span class="label">ê²½ë„</span><input id="editLon" type="number" step="0.000001" /></div>
          </div>
          <div class="row">
            <button id="editPick">ì§€ë„ì—ì„œ ì¢Œí‘œ ì„ íƒ</button>
            <span style="flex:1"></span>
            <button id="editSave">ì €ì¥</button>
            <button id="editCancel">ë‹«ê¸°</button>
          </div>
        </div>
      </div>
    </div>

    <div class="pane">
      <h2>â• ê³„ì‚°ëœ êµì°¨ì </h2>
      <div class="pane-content">
        <div class="list" id="crossList"></div>
        <div class="row">
          <button id="clearXRemoved">ìˆ¨ê¸´ êµì°¨ì  í‘œì‹œ</button>
        </div>
      </div>
    </div>

    <div class="pane">
      <h2>âœ ì§€ë„ ë„í˜• í¸ì§‘</h2>
      <div class="pane-content">
        <div class="row">
          <button id="clearShapes">ëª¨ë“  ë„í˜• ì‚­ì œ</button>
        </div>
        <div class="help">ê·¸ë¦° ë„í˜•/ë§ˆì»¤ë¥¼ í´ë¦­í•´ ìƒ‰ìƒ/ë¼ë²¨ ë³€ê²½ ê°€ëŠ¥</div>
      </div>
    </div>

    <div class="pane">
      <h2>ğŸ’¾ ë°ì´í„° ìŠ¤ëƒ…ìƒ· / ê°€ì ¸ì˜¤ê¸°Â·ë‚´ë³´ë‚´ê¸°</h2>
      <div class="pane-content">
        <div class="row">
          <button id="saveSnapshot">ìŠ¤ëƒ…ìƒ· ì €ì¥</button>
          <button id="loadSnapshot">ìŠ¤ëƒ…ìƒ· ë¶ˆëŸ¬ì˜¤ê¸°</button>
          <button id="exportSnapshot">JSON ë‚´ë³´ë‚´ê¸°</button>
          <label class="pill"><input type="file" id="importFile" style="display:none"><span>JSON ê°€ì ¸ì˜¤ê¸°</span></label>
        </div>
      </div>
    </div>

    <!-- ìˆ¨ê¹€ ìŠ¤í…(ì´ë²¤íŠ¸ ë°”ì¸ë”© ì¶©ëŒ ë°©ì§€) -->
    <div id="editPanel" hidden>
      <button id="closeEditBtn" type="button"></button>
      <button id="saveEditBtn" type="button"></button>
    </div>
  <button id="asideToggle" type="button" title="ì‚¬ì´ë“œë°” ìˆ¨ê¸°ê¸°"></button>
</aside>

  <main>
<button id="asideExpand" type="button" title="ì‚¬ì´ë“œë°” ë³´ì´ê¸°"></button>

    <div id="map"></div>
</main>

</body>
</html>
